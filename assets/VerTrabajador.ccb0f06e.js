import{u as B,c as y,Q as f,a as I,b as g}from"./QCard.5686ad5f.js";import{J as S,r as _,U as C,K as c,at as V,Y as e,O as a,W as h,M as n,p as E,L as w,Q as b,X as Q,au as F,b as N,V as s,R as i}from"./index.00c1b7ba.js";import{a as P,Q as D}from"./QPageSticky.d153300a.js";import{Q as q}from"./QPage.86c4b5c1.js";import{c as v,s as j,m as x}from"./supabase.7a60f0a8.js";import{u as L}from"./app.9f400080.js";import{F as z}from"./FormularioItem.c9533a50.js";import{B as R,c as T,Q as A,C as G}from"./BorrarItem.f88052be.js";import"./uid.c4af4a8b.js";import"./format.87ff2225.js";const J={components:{BorrarItem:R},props:["trabajador","correo"],setup(t){const l=B(),d=_(!1),o=_({});async function m(){if(o.value.password===o.value.password2){d.value=!1,v(!0);let{data:u,error:r}=await j.auth.signUp({email:o.value.email,password:o.value.password});if(r)x(r);else{console.log(u);let U="123";const{data2:co,error2:k}=await j.from("trabajadores").update({usuario:U}).eq("id",t.trabajador);k?x(k):(Cookies.set("mensajito",{tipo:"positive",mensaje:"Usuario creado con \xE9xito"},{expires:"10m"}),router.push("/trabajadores/"+t.trabajador)),v(!1)}}else l.notify({type:"warning",message:"Debe escribir la misma contrase\xF1a las dos veces."})}async function p(){o.value={},o.value.email=t.correo,d.value=!0}return{dialog:d,start:p,rules:[u=>u&&u.length>0||"Complete este campo"],onSubmit:m,row:o}}},K={class:"text-center"},M=e("div",{class:"text-h6"},"Crear usuario para el trabajador",-1),O={key:0},W=e("br",null,null,-1),X=e("br",null,null,-1),Y={class:"row"},H={class:"col"},Z={class:"col-auto text-right"};function $(t,l,d,o,m,p){const u=C("BorrarItem");return c(),V(F,null,[e("div",K,[a(h,{label:"Crear un usuario",push:"",color:"primary","no-caps":"",icon:"person",onClick:o.start},null,8,["onClick"])]),a(A,{modelValue:o.dialog,"onUpdate:modelValue":l[3]||(l[3]=r=>o.dialog=r),persistent:"","transition-show":"slide-down","transition-hide":"slide-down"},{default:n(()=>[a(y,{style:{width:"700px","max-width":"80vw"}},{default:n(()=>[a(f,{class:"row items-center q-pb-none"},{default:n(()=>[M,a(T),E(a(h,{icon:"close",flat:"",round:"",dense:""},null,512),[[G]])]),_:1}),t.loading?(c(),V("div",O,[W,a(P,{indeterminate:""})])):(c(),w(f,{key:1},{default:n(()=>[a(I,{onSubmit:o.onSubmit},{default:n(()=>[a(g,{modelValue:o.row.email,"onUpdate:modelValue":l[0]||(l[0]=r=>o.row.email=r),type:"email",label:"Correo electr\xF3nico","lazy-rules":"",rules:o.rules,readonly:""},{prepend:n(()=>[a(b,{name:"email"})]),_:1},8,["modelValue","rules"]),a(g,{filled:"",modelValue:o.row.password,"onUpdate:modelValue":l[1]||(l[1]=r=>o.row.password=r),type:"password",label:"Contrase\xF1a","lazy-rules":"",rules:[r=>!!r||"* Escriba una contrase\xF1a",r=>r.length>5||"La contrase\xF1a debe tener m\xEDnimo 6 car\xE1cteres"]},{prepend:n(()=>[a(b,{name:"emergency"})]),_:1},8,["modelValue","rules"]),a(g,{filled:"",modelValue:o.row.password2,"onUpdate:modelValue":l[2]||(l[2]=r=>o.row.password2=r),type:"password",label:"Confirmar contrase\xF1a","lazy-rules":"",rules:[r=>!!r||"* Escriba una contrase\xF1a",r=>r.length>5||"La contrase\xF1a debe tener m\xEDnimo 6 car\xE1cteres"]},{prepend:n(()=>[a(b,{name:"emergency"})]),_:1},8,["modelValue","rules"]),X,e("div",Y,[e("div",H,[t.accion==="Editar"?(c(),w(u,{key:0,index:t.index,id:t.id,tabla:"trabajadores",onBorrado:t.borrado},null,8,["index","id","onBorrado"])):Q("",!0)]),e("div",Z,[a(h,{push:"","no-caps":"",type:"submit",label:"Guardar",color:"primary"})])])]),_:1},8,["onSubmit"])]),_:1}))]),_:1})]),_:1},8,["modelValue"])],64)}var oo=S(J,[["render",$]]);const eo={components:{FormularioItem:z,CrearUsuario:oo},setup(){B();const t=L(),l=N();t.titulo=l.currentRoute._value.name,_(null);const d=_();async function o(){v(!0);let{data:m,error:p}=await j.from("trabajadores").select(`
        id,nombre,nombre2,apellido1,apellido2,ni,email,telefono,direccion,usuario,
        cargo (
          id,
          nombre          
        )      
      `);p?x(p):d.value=m[0],v(!1)}return o(),{row:d,borrado:function(m){l.push("/trabajadores")},editado:function(m,p){l.go()}}}},ao={class:"text-h6"},ro={class:"text-subtitle2"},lo={class:"row q-col-gutter-md"},no={class:"col"},to={key:0},so={class:"col"},io=e("br",null,null,-1);function uo(t,l,d,o,m,p){const u=C("CrearUsuario"),r=C("FormularioItem");return o.row?(c(),w(q,{key:0,padding:""},{default:n(()=>[a(y,null,{default:n(()=>[a(f,null,{default:n(()=>[e("div",ao,s(o.row.nombre)+" "+s(o.row.nombre2)+" "+s(o.row.apellido1)+" "+s(o.row.apellido2),1),e("div",ro,s(o.row.cargo.nombre),1)]),_:1}),a(f,null,{default:n(()=>[e("div",lo,[e("div",no,[e("p",null,[i(" Primer nombre: "),e("b",null,s(o.row.nombre),1)]),o.row.nombre2?(c(),V("p",to,[i(" Segundo nombre: "),e("b",null,s(o.row.nombre2),1)])):Q("",!0),e("p",null,[i(" Primer apellido: "),e("b",null,s(o.row.apellido1),1)]),e("p",null,[i(" Segundo apellido: "),e("b",null,s(o.row.apellido2),1)])]),e("div",so,[e("p",null,[a(b,{name:"email"}),i(" Carne de identidad: "),e("b",null,s(o.row.ni),1)]),e("p",null,[a(b,{name:"email"}),i(" Correo electr\xF3nico: "),e("b",null,s(o.row.email),1)]),e("p",null,[a(b,{name:"phone"}),i(" Tel\xE9fono: "),e("b",null,s(o.row.telefono),1)]),e("p",null,[a(b,{name:"place"}),i(" Direcci\xF3n: "),e("b",null,s(o.row.direccion),1)])])])]),_:1})]),_:1}),io,o.row.usuario?(c(),w(y,{key:0},{default:n(()=>[a(f,{class:"text-center"},{default:n(()=>[i(" Este trabajador tiene usuario en sta aplicaci\xF3n ")]),_:1})]),_:1})):(c(),w(u,{key:1,trabajador:o.row.id,correo:o.row.email},null,8,["trabajador","correo"])),a(D,{position:"bottom-right",offset:[18,18]},{default:n(()=>[a(r,{ref:"formulario",editar:o.row,onNuevo:t.nuevo,onEditado:o.editado,onBorrado:o.borrado},null,8,["editar","onNuevo","onEditado","onBorrado"])]),_:1})]),_:1})):Q("",!0)}var Co=S(eo,[["render",uo]]);export{Co as default};
